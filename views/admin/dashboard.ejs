<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <title>–ê–¥–º–∏–Ω–∫–∞</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f7f9fc;
      color: #333;
      max-width: 900px;
      margin: 20px auto;
      padding: 0 20px 50px;
    }

    header {
      background-color: #2196f3;
      padding: 20px 30px;
      border-radius: 8px;
      color: #fff;
      box-shadow: 0 4px 8px rgba(17, 82, 136, 0.3);
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-weight: 700;
      font-size: 2em;
      user-select: none;
    }

    nav {
      margin-top: 15px;
    }

    nav a {
      color: #e3f2fd;
      text-decoration: none;
      margin: 0 18px;
      font-weight: 600;
      font-size: 1.1em;
      padding: 6px 10px;
      border-radius: 4px;
      transition: background-color 0.25s ease, color 0.25s ease;
      display: inline-block;
    }

    nav a:hover,
    nav a:focus {
      background-color: #1976d2;
      color: #fff;
      outline: none;
    }

    nav a.logout {
      color: #ff7961;
      font-weight: 700;
      margin-left: 30px;
    }

    nav a.logout:hover,
    nav a.logout:focus {
      background-color: #f44336;
      color: #fff;
    }


    h1,
    h2,
    h3 {
      color: #444;
    }

    form {
      margin-bottom: 10px;
    }

    input,
    select,
    button,
    textarea {
      margin: 5px 0;
      padding: 5px;
    }

    ul {
      list-style-type: none;
      padding: 0;
    }

    #donate-section {
      max-width: 600px;
      margin: 0 auto 40px;
      text-align: center;
    }

    #donate-section ul li,
    #servers-section ul li {
      background: #fff;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;

      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .donate-text,
    .server-text {
      text-align: left;
      flex-grow: 1;
      margin-right: 10px;
    }

    .donate-text b,
    .server-text b {
      display: block;
      font-size: 1.1em;
      margin-bottom: 4px;
    }

    .donate-text .description {
      font-size: 0.9em;
      color: #666;
      margin-top: 0;
    }

    button.add {
      background: #4caf50;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }

    button.delete {
      background: #f44336;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }

    button.edit {
      background: #2196f3;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }

    .edit-form {
      margin-top: 10px;
      background: #f0f0f0;
      padding: 10px;
      border: 1px dashed #aaa;
    }
  </style>
</head>

<body>

  <header
    style="background:#2c3e50; padding:15px 20px; color:white; text-align:center; margin-bottom:30px; border-radius:8px;">
    <h1 style="margin:0; font-weight:700; color:white; font-size:1.8em;">üëë –ê–¥–º–∏–Ω–∫–∞</h1>
    <nav style="margin-top:15px;">
      <a href="/" style="color:white; text-decoration:none; margin:0 15px; font-weight:600; font-size:1.1em;">
        –ì–ª–∞–≤–Ω–∞—è
      </a>
      <a href="/admin/purchases"
        style="color:white; text-decoration:none; margin:0 15px; font-weight:600; font-size:1.1em;">
        üõí –ü–æ–∫—É–ø–∫–∏
      </a>
      <a href="#servers-section"
        style="color:white; text-decoration:none; margin:0 15px; font-weight:600; font-size:1.1em;">
        üåê –°–µ—Ä–≤–µ—Ä—ã
      </a>
      <a href="#donate-section-title"
        style="color:white; text-decoration:none; margin:0 15px; font-weight:600; font-size:1.1em;">
        üíé –î–æ–Ω–∞—Ç—ã
      </a>
      <a href="#background-section"
        style="color:white; text-decoration:none; margin:0 15px; font-weight:600; font-size:1.1em;">
        üñº –§–æ–Ω
      </a>
      <a href="/admin/edit-rules"
        style="color:white; text-decoration:none; margin:0 15px; font-weight:600; font-size:1.1em;">
        üìú –ü—Ä–∞–≤–∏–ª–∞
      </a>
      <a href="/admin/logout" style="color:#f44336; font-weight:700; margin-left:25px; text-decoration:none;">
        üö™ –í—ã–π—Ç–∏
      </a>
    </nav>
  </header>

  <!-- –°–µ—Ä–≤–µ—Ä—ã -->
  <h2>üåê –°–µ—Ä–≤–µ—Ä—ã</h2>
  <div id="servers-section">
    <% if (Array.isArray(servers) && servers.length> 0) { %>
      <ul>
        <% servers.forEach(srv=> { %>
          <li>
            <div class="item-header">
              <div class="server-text">
                <b>
                  <%= srv.name %>
                </b>
                <p>
                  <%= srv.ip %>
                </p>
              </div>
              <div>
                <form method="POST" action="/admin/delete-server" style="display:inline;">
                  <input type="hidden" name="id" value="<%= srv.id %>" />
                  <button type="submit" class="delete">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                </form>
                <button class="edit" onclick="toggleEdit('server-<%= srv.id %>')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              </div>
            </div>
            <div id="server-<%= srv.id %>" class="edit-form" style="display:none;">
              <form method="POST" action="/admin/edit-server">
                <input type="hidden" name="id" value="<%= srv.id %>" />
                <input name="name" value="<%= srv.name %>" placeholder="–ò–º—è —Å–µ—Ä–≤–µ—Ä–∞" required /><br />
                <input name="ip" value="<%= srv.ip %>" placeholder="IP —Å–µ—Ä–≤–µ—Ä–∞" required /><br />
                <input name="avatar" value="<%= srv.avatar %>" required /><br />
                <input name="rconHost" value="<%= srv.rconHost %>" placeholder="RCON Host" required /><br />
                <input name="rconPort" value="<%= srv.rconPort %>" type="number" placeholder="RCON Port"
                  required /><br />
                <input name="rconPassword" value="<%= srv.rconPassword %>" placeholder="RCON –ü–∞—Ä–æ–ª—å" required /><br />
                <button class="add" type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              </form>
            </div>
          </li>
          <% }) %>
      </ul>
      <% } else { %>
        <p>–ù–µ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤</p>
        <% } %>

          <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</h3>
          <form method="POST" action="/admin/add-server">
            <input name="id" placeholder="ID —Å–µ—Ä–≤–µ—Ä–∞" required /><br />
            <input name="name" placeholder="–ò–º—è —Å–µ—Ä–≤–µ—Ä–∞" required /><br />
            <input name="ip" placeholder="IP —Å–µ—Ä–≤–µ—Ä–∞" required /><br />
            <input name="avatar" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞" required /><br />
            <input name="rconHost" placeholder="RCON Host" required /><br />
            <input name="rconPort" placeholder="RCON Port" type="number" required /><br />
            <input name="rconPassword" placeholder="RCON –ü–∞—Ä–æ–ª—å" required /><br />
            <button class="add" type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
          </form>
  </div>

  <hr />

  <!-- –î–æ–Ω–∞—Ç—ã -->
  <h2 id="donate-section-title">üíé –î–æ–Ω–∞—Ç—ã</h2>
  <div id="donate-section">
    <% if (Object.keys(donateOptions).length> 0) { %>
      <% Object.keys(donateOptions).forEach(serverId=> { %>
        <h3>üåê <%= (servers.find(s=> String(s.id) === String(serverId))?.name || serverId) %></h3>
        <% if (donateOptions[serverId].length> 0) { %>
          <ul>
            <% donateOptions[serverId].forEach(d=> { %>
              <li>
                <div class="item-header">
                  <div class="donate-text">
                    <b>
                      <%= d.name %>
                    </b> (<%= d.price %> —Ä—É–±.)
                      <p class="description">
                        <% if (d.desc) { %>
                          <%- d.desc.replace(/\//g, '<br>/' ) %>
                            <% } else { %>
                              -
                              <% } %>
                      </p>
                  </div>
                  <div>
                    <form method="POST" action="/admin/delete-donate" style="display:inline;">
                      <input type="hidden" name="serverId" value="<%= serverId %>">
                      <input type="hidden" name="id" value="<%= d.id %>" />
                      <button type="submit" class="delete">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                    <button class="edit" onclick="toggleEdit('donate-<%= d.id %>')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                  </div>
                </div>
                <div id="donate-<%= d.id %>" class="edit-form" style="display:none;">
                  <form method="POST" action="/admin/edit-donate:id">
                    <input type="hidden" name="serverId" value="<%= serverId %>">
                    <input type="hidden" name="id" value="<%= d.id %>" />
                    <input name="name" value="<%= d.name %>" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–Ω–∞—Ç–∞" required /><br />
                    <input name="price" value="<%= d.price %>" type="number" placeholder="–¶–µ–Ω–∞" required /><br />
                    <textarea name="description" rows="5" cols="17"><%= d.desc %></textarea><br />
                    <input name="rconCommand" value="<%= d.rconCommand %>" placeholder="RCON –∫–æ–º–∞–Ω–¥–∞" required /><br />
                    <button class="add" type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                  </form>
                </div>
              </li>
              <% }) %>
          </ul>
          <% } else { %>
            <p>–ù–µ—Ç –¥–æ–Ω–∞—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞</p>
            <% } %>
              <% }) %>
                <% } else { %>
                  <p>–ù–µ—Ç –¥–æ–Ω–∞—Ç–æ–≤</p>
                  <% } %>

                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ–Ω–∞—Ç</h3>
                    <form method="POST" action="/admin/add-donate">
                      <select name="serverId" required>
                        <% servers.forEach(srv=> { %>
                          <option value="<%= srv.id %>">
                            <%= srv.name %>
                          </option>
                          <% }) %>
                      </select><br />
                      <input name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–Ω–∞—Ç–∞" required /><br />
                      <input name="price" placeholder="–¶–µ–Ω–∞" type="number" required /><br />
                      <textarea name="desc" rows="5" cols="17" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–Ω–∞—Ç–∞"></textarea><br />
                      <input name="rconCommand" placeholder="RCON –∫–æ–º–∞–Ω–¥–∞ (use {player})" required /><br />
                      <button class="add" type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </form>

  </div>

  <hr />

  <h2 id="background-section">üñº –§–æ–Ω</h2>
  <% if (background && background.image) { %>
    <p>–¢–µ–∫—É—â–∏–π —Ñ–æ–Ω:</p>
    <img src="<%= background.image %>" alt="–§–æ–Ω" style="max-width:300px;" /><br />
    <% } else { %>
      <p>–§–æ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</p>
      <% } %>
        <form method="POST" action="/admin/set-background">
          <input name="image" value="<%= background.image || '' %>" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" required /><br />
          <button class="add" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ–Ω</button>
        </form>

        <hr />

        <h2>üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏</h2>
        <a href="/admin/edit-rules" style="text-decoration: none;" class="add">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞</a>

        <hr />

        <script>
          function toggleEdit(id) {
            const el = document.getElementById(id);
            if (el.style.display === "none" || el.style.display === "") {
              el.style.display = "block";
            } else {
              el.style.display = "none";
            }
          }
        </script>

        <p><a style="text-decoration:none;" href="/admin/logout">üö™ –í—ã–π—Ç–∏</a></p>
</body>

</html>